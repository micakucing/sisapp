(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[840],{11456:(e,a,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/users",function(){return s(90048)}])},22013:(e,a,s)=>{"use strict";s.d(a,{A:()=>o});var r=s(37876),t=s(14232),l=s(14e3),n=s(98467),i=s(20485);function o(e){let{allowedRoles:a,children:s}=e,o=(0,l.useRouter)(),[d,c]=(0,t.useState)(!0),[m,h]=(0,t.useState)(!1);return((0,t.useEffect)(()=>{(async()=>{let e=n.j.currentUser;if(!e)return o.push("/");let s=(0,i.H9)(n.db,"users",e.uid),r=(await (0,i.x7)(s)).data();if(!(null==r?void 0:r.role)){alert("Role belum ditentukan. Hubungi admin!"),o.push("/");return}a.includes(r.role)?h(!0):"siswa"===r.role?o.push("/student/dashboard"):o.push("/"),c(!1)})()},[o,a]),d)?(0,r.jsx)("p",{children:"Loading..."}):m?(0,r.jsx)(r.Fragment,{children:s}):null}},40482:(e,a,s)=>{"use strict";s.d(a,{A:()=>d});var r=s(37876),t=s(48230),l=s.n(t),n=s(89099),i=s(10323),o=s(14232);function d(){let e=(0,n.useRouter)();(0,i.xI)();let[a,s]=(0,o.useState)(!1),[t,d]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{let e=()=>{d(window.innerWidth<992),window.innerWidth>=992&&s(!0)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,r.jsxs)(r.Fragment,{children:[t&&(0,r.jsx)("button",{style:{position:"absolute",right:"0px"},className:"btn btn-dark m-2",onClick:()=>s(!a),children:"â˜° Menu"}),(0,r.jsxs)("div",{className:"bg-dark text-light position-fixed vh-100 p-3 transition",style:{width:"220px",zIndex:1e3,top:"0px",left:a?"0":"-240px",transition:"left 0.3s ease"},children:[(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)("h5",{children:"SIS Dashboard"})}),(0,r.jsx)("ul",{className:"nav nav-pills flex-column mb-auto",children:[{name:"Dashboard",href:"/dashboard"},{name:"Kelas",href:"/classes"},{name:"Siswa",href:"/admin/students/siswa"},{name:"Absensi",href:"/attendance"},{name:"Rekap",href:"/reports"}].map(a=>(0,r.jsx)("li",{className:"nav-item",children:(0,r.jsx)(l(),{href:a.href,className:"nav-link text-light ".concat(e.pathname===a.href?"active bg-primary":""),children:a.name})},a.href))})]})]})}},90048:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>c});var r=s(37876),t=s(14232),l=s(20485),n=s(98467),i=s(10323),o=s(22013),d=s(40482);function c(){let[e,a]=(0,t.useState)([]),[s,c]=(0,t.useState)(null),[m,h]=(0,t.useState)(""),[u,p]=(0,t.useState)({name:"",email:"",password:"",role:"siswa",kelasId:"",rfid:""}),b=async()=>{a((await (0,l.GG)((0,l.rJ)(n.db,"users"))).docs.map(e=>({id:e.id,...e.data()})))};(0,t.useEffect)(()=>{b()},[]);let x=async()=>{if(!u.name||!u.email||!u.password)return alert("Nama, email, dan password wajib diisi");if(!/\S+@\S+\.\S+/.test(u.email))return alert("Email tidak valid");if(u.password.length<6)return alert("Password minimal 6 karakter");try{let e=await fetch("/api/adminUsers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),a=await e.json().catch(()=>({error:"Response bukan JSON"}));if(!e.ok)throw Error(a.error||"Gagal tambah user");alert("User berhasil ditambahkan!"),p({name:"",email:"",password:"",role:"siswa",kelasId:"",rfid:""}),b()}catch(e){console.error(e),alert("Gagal tambah user: "+e.message)}},j=async()=>{if(s.password&&s.password.length<6)return alert("Password minimal 6 karakter");try{let e=await fetch("/api/adminUsers",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),a=await e.json().catch(()=>({error:"Response bukan JSON"}));if(!e.ok)throw Error(a.error||"Gagal update user");alert("User berhasil diupdate!"),c(null),b()}catch(e){console.error(e),alert("Gagal update user: "+e.message)}},f=async e=>{if(confirm("Hapus user ini?"))try{let a=await fetch("/api/adminUsers",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:e})}),s=await a.json().catch(()=>({error:"Response bukan JSON"}));if(!a.ok)throw Error(s.error||"Gagal hapus user");alert("User berhasil dihapus!"),b()}catch(e){console.error(e),alert("Gagal hapus user: "+e.message)}},w=async e=>{if(confirm("Kirim link reset password ke ".concat(e,"?")))try{await (0,i.J1)(n.j,e),alert("Link reset password berhasil dikirim ke ".concat(e))}catch(e){console.error(e),alert("Gagal kirim reset password: "+e.message)}},g=e.filter(e=>e.name.toLowerCase().includes(m.toLowerCase())||e.email.toLowerCase().includes(m.toLowerCase())||e.role.toLowerCase().includes(m.toLowerCase()));return(0,r.jsx)(o.A,{allowedRoles:["admin","guru"],children:(0,r.jsxs)("div",{className:"d-flex",children:[(0,r.jsx)(d.A,{}),(0,r.jsxs)("div",{className:"flex-grow-1 p-4",style:{marginLeft:"220px"},children:[(0,r.jsx)("h2",{className:"mb-4",children:"CRUD Users Admin/Guru"}),!s&&(0,r.jsxs)("div",{className:"card p-3 mb-4",children:[(0,r.jsx)("input",{className:"form-control mb-2",placeholder:"Nama",value:u.name,onChange:e=>p({...u,name:e.target.value})}),(0,r.jsx)("input",{className:"form-control mb-2",placeholder:"Email",value:u.email,onChange:e=>p({...u,email:e.target.value})}),(0,r.jsx)("input",{type:"password",className:"form-control mb-2",placeholder:"Password",value:u.password,onChange:e=>p({...u,password:e.target.value})}),(0,r.jsxs)("select",{className:"form-control mb-2",value:u.role,onChange:e=>p({...u,role:e.target.value}),children:[(0,r.jsx)("option",{value:"siswa",children:"Siswa"}),(0,r.jsx)("option",{value:"guru",children:"Guru"}),(0,r.jsx)("option",{value:"admin",children:"Admin"})]}),"siswa"===u.role&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{className:"form-control mb-2",placeholder:"Kelas ID",value:u.kelasId,onChange:e=>p({...u,kelasId:e.target.value})}),(0,r.jsx)("input",{className:"form-control mb-2",placeholder:"RFID",value:u.rfid,onChange:e=>p({...u,rfid:e.target.value})})]}),(0,r.jsx)("button",{className:"btn btn-success",onClick:x,children:"Tambah User"})]}),s&&(0,r.jsxs)("div",{className:"card p-3 mb-4 border-primary",children:[(0,r.jsxs)("h5",{children:["Edit User: ",s.name]}),(0,r.jsx)("input",{className:"form-control mb-2",placeholder:"Nama",value:s.name,onChange:e=>c({...s,name:e.target.value})}),(0,r.jsx)("input",{className:"form-control mb-2",placeholder:"Email",value:s.email,onChange:e=>c({...s,email:e.target.value})}),(0,r.jsx)("input",{type:"password",className:"form-control mb-2",placeholder:"Password baru (opsional)",value:s.password||"",onChange:e=>c({...s,password:e.target.value})}),(0,r.jsxs)("select",{className:"form-control mb-2",value:s.role,onChange:e=>c({...s,role:e.target.value}),children:[(0,r.jsx)("option",{value:"siswa",children:"Siswa"}),(0,r.jsx)("option",{value:"guru",children:"Guru"}),(0,r.jsx)("option",{value:"admin",children:"Admin"})]}),"siswa"===s.role&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{className:"form-control mb-2",placeholder:"Kelas ID",value:s.kelasId||"",onChange:e=>c({...s,kelasId:e.target.value})}),(0,r.jsx)("input",{className:"form-control mb-2",placeholder:"RFID",value:s.rfid||"",onChange:e=>c({...s,rfid:e.target.value})})]}),(0,r.jsx)("button",{className:"btn btn-primary me-2",onClick:j,children:"Simpan"}),(0,r.jsx)("button",{className:"btn btn-secondary",onClick:()=>c(null),children:"Batal"})]}),(0,r.jsx)("input",{className:"form-control mb-3",placeholder:"Cari user (nama, email, role)",value:m,onChange:e=>h(e.target.value)}),(0,r.jsx)("div",{className:"table-responsive",children:(0,r.jsxs)("table",{className:"table table-bordered table-hover",children:[(0,r.jsx)("thead",{className:"table-light",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Nama"}),(0,r.jsx)("th",{children:"Email"}),(0,r.jsx)("th",{children:"Role"}),(0,r.jsx)("th",{children:"Kelas"}),(0,r.jsx)("th",{children:"RFID"}),(0,r.jsx)("th",{children:"Aksi"})]})}),(0,r.jsx)("tbody",{children:0===g.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:6,className:"text-center",children:"Tidak ada data"})}):g.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.name}),(0,r.jsx)("td",{children:e.email}),(0,r.jsx)("td",{children:e.role}),(0,r.jsx)("td",{children:e.kelasId||"-"}),(0,r.jsx)("td",{children:e.rfid||"-"}),(0,r.jsxs)("td",{children:[(0,r.jsx)("button",{className:"btn btn-warning btn-sm me-2",onClick:()=>c(e),children:"Edit"}),(0,r.jsx)("button",{className:"btn btn-danger btn-sm me-2",onClick:()=>f(e.uid),children:"Hapus"}),(0,r.jsx)("button",{className:"btn btn-info btn-sm",onClick:()=>w(e.email),children:"Reset Password"})]})]},e.id))})]})})]})]})})}}},e=>{e.O(0,[0,636,593,792],()=>e(e.s=11456)),_N_E=e.O()}]);