(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[599],{22013:(e,a,s)=>{"use strict";s.d(a,{A:()=>r});var t=s(37876),n=s(14232),l=s(14e3),d=s(98467),i=s(20485);function r(e){let{allowedRoles:a,children:s}=e,r=(0,l.useRouter)(),[c,o]=(0,n.useState)(!0),[h,u]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{(async()=>{let e=d.j.currentUser;if(!e)return r.push("/");let s=(0,i.H9)(d.db,"users",e.uid),t=(await (0,i.x7)(s)).data();if(!(null==t?void 0:t.role)){alert("Role belum ditentukan. Hubungi admin!"),r.push("/");return}a.includes(t.role)?u(!0):"siswa"===t.role?r.push("/student/dashboard"):r.push("/"),o(!1)})()},[r,a]),c)?(0,t.jsx)("p",{children:"Loading..."}):h?(0,t.jsx)(t.Fragment,{children:s}):null}},32383:()=>{},43092:(e,a,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/attendance/rekap-bulanan",function(){return s(75649)}])},75649:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>h});var t=s(37876),n=s(14232),l=s(22013),d=s(98467),i=s(20485),r=s(12770),c=s(49473),o=s(14312);function h(){let[e,a]=(0,n.useState)("X IPA 1"),[s,h]=(0,n.useState)(new Date().toISOString().slice(0,7)),[u,m]=(0,n.useState)([]);return(0,n.useEffect)(()=>{(async function(){let a=(await (0,i.GG)((0,i.P)((0,i.rJ)(d.db,"students"),(0,i._M)("kelas","==",e)))).docs.map(e=>({id:e.id,...e.data()})),[t,n]=s.split("-"),l=new Date(t,n-1,1,0,0,0),r=new Date(t,n,0,23,59,59),c=(await (0,i.GG)((0,i.P)((0,i.rJ)(d.db,"attendance"),(0,i._M)("timestamp",">=",l),(0,i._M)("timestamp","<=",r),(0,i.My)("timestamp","asc")))).docs.map(e=>({id:e.id,...e.data()}));m(a.map(e=>{let a=c.filter(a=>a.studentId===e.id).length,s=new Date(t,n,0).getDate();return{...e,hadir:a,bolos:s-a}}))})(),async function(){let e=(await (0,i.GG)((0,i.rJ)(d.db,"classes"))).docs.map(e=>({id:e.id,...e.data()}));setDaftarKelas(e),e.length>0&&a(e[0].name)}()},[e,s]),(0,t.jsx)(l.A,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:"Rekap Absensi Bulanan"}),(0,t.jsxs)("div",{className:"row my-3",children:[(0,t.jsx)("div",{className:"col-md-3",children:(0,t.jsx)("select",{className:"form-select",value:e,onChange:e=>a(e.target.value),children:daftarKelas.map(e=>(0,t.jsx)("option",{value:e.name,children:e.name},e.id))})}),(0,t.jsx)("div",{className:"col-md-3",children:(0,t.jsx)("input",{type:"month",className:"form-control",value:s,onChange:e=>h(e.target.value)})}),(0,t.jsxs)("div",{className:"col-md-6 text-end",children:[(0,t.jsx)("button",{className:"btn btn-success me-2",onClick:()=>{let a=r.Wp.json_to_sheet(u.map((e,a)=>({No:a+1,Nama:e.name,NIS:e.nis,Kelas:e.kelas,Hadir:e.hadir,"Tidak Hadir":e.bolos}))),t=r.Wp.book_new();r.Wp.book_append_sheet(t,a,"Rekap Bulanan");let n=r.M9(t,{bookType:"xlsx",type:"array"});(0,c.saveAs)(new Blob([n],{type:"application/octet-stream"}),"Rekap_Bulanan_".concat(e,"_").concat(s,".xlsx"))},children:"Export Excel"}),(0,t.jsx)("button",{className:"btn btn-danger",onClick:()=>{let a=new o.Ay;a.text("Rekap Absensi Bulanan ".concat(e," - ").concat(s),14,15);let t=u.map((e,a)=>[a+1,e.name,e.nis,e.kelas,e.hadir,e.bolos]);a.autoTable({head:[["No","Nama","NIS","Kelas","Hadir","Tidak Hadir"]],body:t,startY:20}),a.save("Rekap_Bulanan_".concat(e,"_").concat(s,".pdf"))},children:"Export PDF"})]})]}),(0,t.jsx)("div",{className:"table-responsive",children:(0,t.jsxs)("table",{className:"table table-bordered table-striped",children:[(0,t.jsx)("thead",{className:"table-dark",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"No"}),(0,t.jsx)("th",{children:"Nama"}),(0,t.jsx)("th",{children:"NIS"}),(0,t.jsx)("th",{children:"Kelas"}),(0,t.jsx)("th",{children:"Hadir"}),(0,t.jsx)("th",{children:"Tidak Hadir"})]})}),(0,t.jsx)("tbody",{children:u.map((e,a)=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:a+1}),(0,t.jsx)("td",{children:e.name}),(0,t.jsx)("td",{children:e.nis}),(0,t.jsx)("td",{children:e.kelas}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"badge bg-success",children:e.hadir})}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"badge bg-danger",children:e.bolos})})]},e.id))})]})})]})})}s(9665)},83686:()=>{}},e=>{e.O(0,[509,155,347,0,552,636,593,792],()=>e(e.s=43092)),_N_E=e.O()}]);