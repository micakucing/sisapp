(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[79],{92493:(a,e,t)=>{"use strict";t.r(e),t.d(e,{default:()=>i});var s=t(37876),c=t(14232),n=t(20485),r=t(98467);function i(){let[a,e]=(0,c.useState)(""),[t,i]=(0,c.useState)("");(0,c.useEffect)(()=>{if(!a)return;let e=setTimeout(()=>l(a),200);return()=>clearTimeout(e)},[a]);let l=async a=>{try{let t=await (0,n.x7)((0,n.H9)(r.db,"settings","attendance")),s=t.exists()?t.data():{jamMasuk:"07:30",jamPulang:"15:00"},[c,l]=s.jamMasuk.split(":").map(Number),[u,m]=s.jamPulang.split(":").map(Number),o=new Date,d=new Date;d.setHours(c,l,0,0);let h=new Date;h.setHours(u,m,0,0);let b=(0,n.P)((0,n.rJ)(r.db,"users"),(0,n._M)("rfid","==",a),(0,n._M)("role","==","siswa")),k=await (0,n.GG)(b);if(k.empty){i("RFID tidak valid!"),e("");return}let p=k.docs[0].data(),w=k.docs[0].id,_=new Date().toISOString().split("T")[0],f="".concat(w,"_").concat(_),N=(0,n.H9)(r.db,"attendance",f),j=await (0,n.x7)(N),g=o>d;j.exists()?j.data().checkOut?i("".concat(p.name," sudah check-out hari ini")):o<h?i("".concat(p.name," belum bisa check-out sebelum jam pulang (").concat(s.jamPulang,")")):(await (0,n.mZ)(N,{checkOut:(0,n.O5)()}),i("".concat(p.name," berhasil check-out"))):(await (0,n.BN)(N,{studentId:w,name:p.name,kelasId:p.kelasId,rfid:p.rfid,checkIn:(0,n.O5)(),checkOut:null,date:o,status:g?"Terlambat":"Hadir"}),i("".concat(p.name," berhasil check-in ").concat(g?"(Terlambat)":""))),e("")}catch(a){console.error(a),i("Gagal memproses absensi: "+a.message),e("")}};return(0,s.jsxs)("div",{className:"container py-4",children:[(0,s.jsx)("h2",{className:"mb-4",children:"Scan RFID Siswa"}),(0,s.jsxs)("div",{className:"card p-3 mb-4",children:[(0,s.jsx)("input",{className:"form-control mb-2",placeholder:"Scan RFID",value:a,onChange:a=>e(a.target.value),autoFocus:!0}),t&&(0,s.jsx)("div",{className:"mt-2 alert alert-info",children:t})]})]})}},94222:(a,e,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/public-scan",function(){return t(92493)}])}},a=>{a.O(0,[636,593,792],()=>a(a.s=94222)),_N_E=a.O()}]);